name: 'Release test'

on:
  workflow_dispatch:

jobs:
  publish-tauri:
    permissions:
      contents: write

    strategy:
      fail-fast: false
      matrix:
        include:
          - platform: 'ubuntu-22.04' # for Tauri v1 you could replace this with ubuntu-20.04.
            args: ''

    runs-on: ${{ matrix.platform }}

    steps:
      - name: Get version from tag
        id: tag_name
        run: |
          echo "current_version=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: Get Changelog Entry
        id: changelog_reader
        uses: mindsers/changelog-reader-action@v2
        with:
          validation_level: warn
          version: ${{ steps.tag_name.outputs.current_version }}
          path: ./CHANGELOG.md

      - name: Echo Changelog Entry
        run: |
          echo "
            tag: ${{ steps.changelog_reader.outputs.version }}
            name: Release ${{ steps.changelog_reader.outputs.version }}
            body: ${{ steps.changelog_reader.outputs.changes }}
            prerelease: ${{ steps.changelog_reader.outputs.status == 'prereleased' }}
            draft: ${{ steps.changelog_reader.outputs.status == 'unreleased' }}
            allowUpdates: true
            token: ${{ secrets.GITHUB_TOKEN }}
          "